---
title: vim 使用技巧（一）- Vim 解决问题的方式
date: 2019-08-29 10:33:30
tags: 
  - vim
  - reading
  - note
  - vim 使用技巧
categories: 读书笔记
---

本质上讲，我们的工作是重复性的。不论是在几个不同的地方做相同的小改动，还是在文档的相似结构间移动，我们都会重复很多操作。凡是可以简化重复性操作的方式，都会成倍地节省我们的时间。

<!--more-->

## 技巧1： 结识  `.` 命令

> `.` 命令可以让我们重复上次的修改

**测试文本**

```bash
$ cat test.txt
Line one
Line two
Line three
Line four
```

`x` 命令会删除光标下的字符，在这种情况下使用 `.` 命令 “重复上次修改” 时，就会让 Vim 删除光标下的字符：

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/1-1.png?raw=true)

`>G` 命令会增加从当前行到文档末尾处的缩进层级，如果我们在使用了此命令之后使用了 `.` 命令，那么 “重复上次修改” 会让 vim 增加从当前行到文档末尾的缩进层级：

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/1-2.png?raw=true)

`x`， `>` 命令都是在普通模式中执行的命令，不过，我们每次进入插入模式时，也会形成一次修改。从进入插入模式的那一刻起，直至返回普通模式，vim 会记录每一个按键操作。做出这样一个修改后再用 `.` 命令，它会重新执行所有这些按键的操作（参见[技巧 8]()）。

**`.` 是一个微型的宏**

## 技巧2： 不要自我重复

> 对于在行尾添加内容这样常见的操作，如添加 `;`，vim 专门提供了一个专门的命令，可以把两步操作合成一步

**测试文件**

```javascript
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

在每一行的末尾添加分号 `;`

**普通方法**

1. 使用 `$` 到行尾
2. 使用 `a` 在光标之后插入
3. 添加 `;`
4. `Esc` 退出插入模式
5. `j`
6. `$`
7. `.` ： 此时 `.` 代替了三个键（`a` `;` `Esc`） 

**减少不相关的移动**

- 使用 `A` 代替 `$` 和 `a`

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/2-1.png?raw=true)

一键移动，另一键操作，真是太完美了！请留意这种应用模式，因为我们即将在更多的例子中看到它的身影。

虽然这一模式对这个简短的例子来说很好用，但它不是万能的。试想一下，如果我们不得不给连续 50 行添加分号，即便每个修改输一次 j. ，看起来也是一项很繁重的工作。跳到[技巧 30]() 可以看到另外一种解决方法。

## 技巧3： 以退为进

> 我们可以用一种常用的 vim 操作习惯在一个字符前后各添加一个空格。乍一看，这种方法比较古怪，不过好处是可以重复

**测试文本**

```javascript
var foo = "method("+argument1+","+argument2+")";
// 需要改变为：
var foo = "method(" + argument1 + "," + argument2 + ")";
```

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/3-1.png?raw=true)

**使移动可重复**

`f{char}` 命令让 vim 查找下一处指定字符出现的位置，如果找到了，就直接把光标移动到那里（详细可见 `:h f`）。因此当我们输入 `f+` 时，光标会直接移到下一个出现 `+` 的位置。我们将会在[技巧 49]() 里学到更多关于 `f{char}` 命令的知识。

完成第一处修改后，可以直接重复按 `f+` 去找下一个加号，不过 `;` 命令会重复查找上次 `f` 命令所查找的字符，因此我们不用连续输入 4 次 `f+`，而是只用输入一次，剩下的直接输入 `;` 就好了。

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/3-2.png?raw=true)

`s` 命令把两个操作合为一个：它先删除光标下的字符，然后进入插入模式。在删除 `+` 后，我们先输入 ` + ` ，然后退出插入模式。

先退一步，然后前进三步，看起来可能不够直接。但是这样做的最大的好处是：我们可以使用 `.` 命令重复这一修改操作。我们需要做的只是把光标移动到下一个 `+` 处，使用 `.` 命令重复这一操作即可。

## 技巧4： 执行、重复、返回

> 在面对重复性工作时，我们需要移动动作和修改动作都能够重复，这样就可以达到一个最佳的编辑模式。这样 vim 就可以记住我们的操作。本节是介绍这些可重复操作，并学习如何回退。

- `.` 可以重复上次修改
- `@:` 可以用来重复任意 ex 命令（在[技巧 31]() 中讨论）
- `&` 可以重复上一次的 `:substitute` 命令（参见[技巧 92]()）

当 vim 让一个操作或移动可以很方便的重复时，它总是会提供某种方式，让我们在不小心做过头时能够回退，表 1-1 总结了 vim 中可重复执行的命令，以及相应的回退方式。

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/4-1.png?raw=true)

## 技巧5： 查找并手动替换

> vim 提供了一个 `:substitute` 命令专门用于查找替换功能，不过用上面的技术，我们也可以手动修改第一个出现的地方，然后再一个一个的替换其他匹配项。

**测试文本**

在下面这段文本中，每一行都出现了单词 *content*

```
...We're waiting for content before the site can go live...
...If you are content with this, let's go ahead with it...
...We'll launch as soon as we have the content...
```

假设我们想用单词 *copy* 来替代 *content*，其实很简单，只需要：

```vim
:%s/content/copy/g
```

但是我们并不想所有的 *content* 都被替换成 *copy*，因为有的地方可能会出现语义错误。需要时刻留神，对每个地方都要问 *这里需要修改吗？*，`subtitute` 也能胜任这个工作（[技巧 89]()），不过我们这里有另一种方法.

**偷懒的办法： 无需输入就可以进行查找**

`*` 命令可以查找当前光标下的单词（详见： `:h *`）。我们可以先直接查找 *content* 单词：

```vim
/content
```

或者，简单的把光标放在这个单词上，然后按 `*` 键：

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/5-1.png?raw=true)

刚开始，把光标移动到 *content* 上，然后使用 `*` 命令，这样会产生两个结果：

- 光标会跳到下一个匹配项上
- 所有出现这个词的地方都会被高亮，如果没有高亮，需要设置 `:set hls`，详情可见[技巧 80]()

执行过一次查找的命令之后，我们只需要按 `n` 就可以跳到下一个匹配项了，按 `N` 就是返回到上一次搜索的地方。

**使修改可重复**

当光标位于 *content* 的开头时，我们就可以开始修改了：需要删除这个单词，然后输入代替的词。`cw` 命令将这两步合成了一步。

因此只需要 `cw` *copy* `Esc` 就修改完成了，按 `n` 到下一个匹配处，考虑是否需要修改，需要修改的话就按 `.` 重复上一次修改。

## 技巧6： 结识 `.` 范式

> 到目前为止的三个简单的编辑任务，我们都使用了 `.` 命令解决了问题。

**回顾前面三个 `.` 命令编辑任务**

在[技巧 2](https://joker764.github.io/2019/08/29/vim-使用技巧（一）/#技巧2：-不要自我重复) 中，我们想在一系列行的结尾添加分号。我们先用 `A;<Esc>`修改了第一行，做完这步准备后，就可以使用 . 命令对后续行重复此修改。我们使用了` j `命令在行间移动，要完成剩余的修改，只需简单地按足够多次 `j. `就可以了。

在[技巧 3](https://joker764.github.io/2019/08/29/vim-使用技巧（一）/#技巧3：-以退为进) 中，我们想为每个` +` 号的前后各添加一个空格。我们先用 `f+` 命令跳到目标字符上，然后用 `s` 命令把一个字符替换成 3 个，做完这步准备后，我们就可以按若干次 `;.` 完成此任务。

在[技巧 5](https://joker764.github.io/2019/08/29/vim-使用技巧（一）/#技巧5：-查找并手动替换) 中，我们想把每处出现单词 *content* 的地方都替换成 *copy*。我们使用 `*` 命令来查找目标单词，然后用 `cw` 命令修改第一处地方。做完这步准备后，就可以用 `n` 键跳到下一匹配项，然后用 `.` 键做相同的修改。要完成这项任务，只需简单地按足够多次 `n.` 就行了。

**理想模式： 用一键移动，另一键执行**

这些例子的共同点就是：*用一键移动，另一键执行*，为了方便起见，我们把它称作 *`.`  范式*。

