---
title: vim 实用技巧（二）- 普通模式
date: 2019-08-30 13:34:40
tags: 
  - vim
  - reading
  - note
  - vim 实用技巧
categories: 读书笔记
---

普通模式是 vim 的自然放松状态，其他文本编辑器大部分时间都处于类似于 vim 插入模式的状态中。普通模式命令的强大，很大程度上源于他可以把操作符与动作结合在一起。

<!--more-->

## 技巧7： 停顿时请移开画笔

> 对于不习惯 vim 的人来说，普通模式看上去是一种奇怪的缺省状态，但有经验的 vim 用户却很难想象还有其他任何方式。

你估计画家会花费多少时间用画笔在画布上作画？毫无疑问，这因人而异，但是，如果这占了画家全部工作时间的一半还要多的话，我会觉得非常诧异。

想一下除了画画外，画家还要做哪些事情。他们要研究主题，调整光线，把颜料混合成新的色彩。而且，在把颜料往画布上画时，谁说他们必须要用画笔？画家也许会换用刻刀来实现不同的质地，或是用棉签来对已经画好的地方进行润色。

画家在休息时不会把画笔放在画布上。对 vim 而言也是这样，普通模式就是 vim的自然放松状态，其名字已经寓示了这一点。

就像画家只花一小部分时间涂色一样，程序员也只花一小部分时间编写代码。绝大多数时间用来思考、阅读，以及在代码中穿梭浏览。而且，当确实需要做修改时，谁说一定要切换到插入模式才行？我们可以重新调整已有代码的格式，复制它们，移动其位置，或是删除它们。在普通模式中，我们有众多的工具可以利用。

## 技巧8： 把撤销单元切成块

> 在其他编辑器中，输入一些词后使用撤销命令，可能会撤销最后输入的词或字符。然而在 vim 中，我们可以自己控制撤销的粒度。

`u` 键会触发撤销命令，它会撤销最新的修改。一次修改可以是改变文档内文本的任意操作，其中包括在普通模式、可视模式以及命令行模式中所触发的命令，而且一次修改也包括了在插入模式中输入（或删除）的文本，因此我们可以说，`i{insert some text}<Esc>` 是一次修改。

在 vim 中，我们可以自己控制撤销命令的粒度。从进入插入模式开始，直到返回普通模式，在此期间输入或删除的任何内容都被视为一次修改。因此我们只需要控制好对 `<Esc>` 键的使用，就可以使撤销命令作用于单词、句子、段落。

在句尾停顿的时候，就可以使用 `<Esc>` 退出插入模式了。在准备好继续写的时候，按 `A` 命令就可以回到原来的地方继续写作。

当处于行尾的时候，另起一行的最快方式是按 `<CR>`，不过更好的方式是 `<Esc>o`，这样会以一行来控制撤销的粒度。

**在插入模式中移动光标会重置修改状态**

当使用了 `<Up>`、`Down`、`Left`、`Right` 这些光标键，将会产生一个新的撤销块，会对 `u`、`.` 等命令产生影响。

## 技巧9： 构造可重复的修改

> vim 对重复操作进行了优化，要利用这一点，我们必须考虑该如何构造修改。

**测试文本**

我们要删除最后一个单词 *nigh*，假设光标已经在最后一个字符 `h` 上了

```
The end is nigh
```

**反向删除**

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/9-1.png?raw=true)

- `db` 命令从光标起始位置到单词开头的位置
- `x` 删除 `db` 命令遗留下来的字符 *h*
- 这个操作的 [vim 高尔夫](http://www.vimgolf.com/)得分是 3 分

**正向删除**

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/9-2.png?raw=true)

- 先使用 `b` 命令把光标移动到单词的开头
- `dw` 命令删除一个单词
- 这个操作的 vim 高尔夫得分是 3 分

**删除整个单词**

我们可以使用更为精确的 `aw` 文本对象，而不是动作命令（详见：`:h aw`）

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/9-3.png?raw=true)

- 可以把 `daw` 解读为 *delete a word* 方便记忆
- 在[技巧 51]() 和[技巧 52]() 中会介绍更多关于文本对象的细节
- 3 分

**哪种方法最具重复性？**

我们尝试了 3 种方法来删除一个词：`dbx`、`bdw`、`daw`。每种情况下的 vim 高尔夫得分都是 3 分。

很明显，`daw` 只有一个操作，最适合和 `.` 配合使用，而且 `daw` 命令还会删除一个空格。

## 技巧10： 用次数做简单的算术运算

> 大多数普通模式命令可以在执行时指定次数，我们可以利用这个功能来做简单的算术运算。

很多普通命令都可以带一个次数前缀，这样 vim 就会尝试把该命令执行指定的次数，而不是只执行一次（详见：`:h count`）

- `<C-a>`： 对数字执行加
- `<C-x>`： 对数字执行减

在不带执行次数的时候，他们会逐个加减，但是如果加上前缀，就可以让他们加减任意整数，比如将光标移动到数字 5 上，执行 `10<C-a>` 就会把它变成 15。

如果光标不在数字上，`<C-a>` 命令 *会把当前光标之上或之后的数值加上 [count]*（详见：`:h ctrl-a`）。因此如果光标不在数字上，会在当前行正向查找一个数字，如果找到了，就直接跳转到那里。

```css
.blog, .news { background-image: url(/sprite.png); }
.blog { background-position: 0px 0px }
```

我们想最后实现：

```css
.blog, .news { background-image: url(/sprite.png); }
.blog { background-position: 0px 0px }
.news { background-position: -180px 0px }
```

我们先使用 `yyp` 复制此行，然后使用 `cw` 修改第一个单词，然后再处理数值：

- 一种做法是用 `f0` 调到此数字，然后进入插入模式手动修改它的值，即 `i-18<Esc>`
- 更好的方法是 `180<c-x>` 

![](https://github.com/Joker764/joker764.github.io/blob/src/images/vim/10-1.png?raw=true)

在本例中，我们只复制了一行并做出改动。但是，假设你要复制 10 份，并对后续数字依次减 180。如果要切换到插入模式去修改每个数字，我们每次都得输入不同内容（-180，然后-360，以此类推）。但是如果用 180<C-x> 命令的话，对后续行也可以采用相同的操作过程。我们甚至还可以把这组按键操作录制成一个宏（详见[第 11章]()），然后根据需要执行多次。

**数字的格式**

007 的后面是什么？

正确的答案是 010，像在某些编程语言中的约定一样，vim 把以 0 开头的数字解释为 8 进制，而不是 10 进制。如果你经常使用 8 进制，vim 的缺省行为或许会适合你，如果不是这样，在 `vimrc` 中，设置：

```bash
set nrformats=
```

这样 vim 会把所有的数字都当作 10 进制，不管他们是不是以 0 开头的。

